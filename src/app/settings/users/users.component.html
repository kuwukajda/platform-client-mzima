<section class="users">
  <app-settings-header
    [settingsTitle]="'app.users'"
    [newButtonTitle]="'user.add_user'"
    [selectedItem]="selectedUsers"
    (isShowActionsChange)="showActions($event)"
    (deleteCall)="deleteUsers()"
  >
  </app-settings-header>

  <div
    class="users-container"
    #user
    (scroll)="onScroll($event)"
    *ngIf="!isLoading || users?.length; else loader"
  >
    <app-spinner class="spinner" *ngIf="!users"></app-spinner>

    <ng-container *ngIf="users?.length; else usersEmpty">
      <table mat-table [dataSource]="users" class="users-table" *ngIf="isDesktop; else userList">
        <ng-container matColumnDef="checkbox">
          <th mat-header-cell *matHeaderCellDef>
            <div class="users-table__checkbox">
              <mat-checkbox
                *ngIf="isShowActions"
                (click)="$event.stopPropagation()"
                (change)="selectAllUsers($event)"
                [checked]="selectedUsers.length === users.length"
              >
              </mat-checkbox>
            </div>
          </th>
          <td mat-cell *matCellDef="let user">
            <div class="users-table__checkbox">
              <mat-checkbox
                *ngIf="isShowActions"
                (click)="$event.stopPropagation()"
                (change)="selectUser($event, user)"
                [checked]="selectedUsers.includes(user.id)"
              >
              </mat-checkbox>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="avatar">
          <th mat-header-cell *matHeaderCellDef>{{ 'user.avatar' | translate }}</th>
          <td mat-cell *matCellDef="let user">
            <div class="users-table__avatar">
              <img
                [src]="'https://www.gravatar.com/avatar/' + user.gravatar + '?d=retro'"
                [alt]="user.realname"
              />
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>{{ 'user.name' | translate }}</th>
          <td mat-cell *matCellDef="let user">
            <strong class="users-table__username">{{ user.realname }}</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef>{{ 'user.role' | translate }}</th>
          <td mat-cell *matCellDef="let user">{{ user.role }}</td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>{{ 'user.email' | translate }}</th>
          <td mat-cell *matCellDef="let user">{{ user.email }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['checkbox', 'avatar', 'name', 'role', 'email']"></tr>
        <tr
          mat-row
          [data-qa]="'user-item' + user.id"
          [routerLink]="['update', user.id]"
          *matRowDef="let user; columns: ['checkbox', 'avatar', 'name', 'role', 'email']"
          class="user-item__row"
        ></tr>
      </table>
    </ng-container>

    <ng-template #userList>
      <div class="user-list">
        <div class="user-item" *ngFor="let user of users" [routerLink]="['update', user.id]">
          <div class="user-item__visual">
            <img
              [src]="'https://www.gravatar.com/avatar/' + user.gravatar + '?d=retro'"
              [alt]="user.realname"
            />
          </div>
          <div class="user-item__content">
            <strong class="user-item__username">{{ user.realname }}</strong>
            <span class="user-item__role">{{ user.role }}</span>
            <span class="user-item__email">{{ user.email }}</span>
          </div>
          <mat-checkbox
            *ngIf="isShowActions"
            class="user-item__checkbox"
            (click)="$event.stopPropagation()"
            (change)="selectUser($event, user)"
            [checked]="selectedUsers.includes(user.id)"
          >
          </mat-checkbox>
        </div>
      </div>
    </ng-template>

    <app-spinner class="users-loading" *ngIf="isLoading"></app-spinner>
    <button
      mat-stroked-button
      (click)="loadMore()"
      class="users-load-more"
      *ngIf="
        !isLoading &&
        params.offset !== undefined &&
        params.limit !== undefined &&
        params.offset + params.limit < total
      "
    >
      {{ 'app.load_more' | translate }}
    </button>
  </div>
  <div class="actions-spacer" *ngIf="isShowActions && !isDesktop"></div>
</section>

<ng-template #loader>
  <app-spinner class="spinner"></app-spinner>
</ng-template>

<ng-template #usersEmpty>
  <span class="posts-empty">{{ 'post.no_posts_yet' | translate }}</span>
</ng-template>

<button
  mat-stroked-button
  (click)="closeModal()"
  class="modal__close-btn"
  tabindex="-1"
  attr.aria-label="{{ 'modal.button.close' | translate }}"
  [data-qa]="'btn-close'"
>
  <mat-icon class="fab-button__icon" svgIcon="close"></mat-icon>
</button>

<ng-container *ngIf="currentView === CollectionView.List; else createForm">
  <div class="head">
    <strong mat-dialog-title>
      {{ (post ? 'set.add_to_collection' : 'app.collection') | translate }}
      <button
        class="tooltip-btn"
        tabindex="-1"
        mat-icon-button
        matTooltipPosition="after"
        matTooltip='
          A "Collection" is a manually-curated group of posts. You may find it useful in grouping posts that you would like to share with external partners. It is not dynamic, meaning the posts within it do not change unless you manually update them.
        '
      >
        <mat-icon svgIcon="tooltip"></mat-icon>
      </button>
    </strong>
    <button
      *ngIf="isLoggedIn && !post && (isDesktop$ | async)"
      type="button"
      color="primary"
      mat-raised-button
      (click)="addNewCollection()"
      tabindex="-1"
    >
      <span>{{ 'app.add_collection' | translate }}</span>
      <mat-icon svgIcon="plus"></mat-icon>
    </button>
  </div>

  <form
    class="search-form"
    [formGroup]="searchForm"
    (ngSubmit)="getCollections(searchForm.get('query')?.value)"
  >
    <div class="form-row">
      <mat-form-field appearance="outline">
        <input
          matInput
          placeholder="{{ 'location.search' | translate }}"
          name="query"
          formControlName="query"
        />
        <mat-icon matPrefix svgIcon="search"></mat-icon>
      </mat-form-field>
    </div>
    <button
      *ngIf="isLoggedIn && !post && !(isDesktop$ | async)!"
      type="button"
      color="primary"
      mat-raised-button
      (click)="addNewCollection()"
      tabindex="-1"
    >
      <span>{{ 'app.add' | translate }}</span>
      <mat-icon svgIcon="plus"></mat-icon>
    </button>
  </form>

  <ng-container *ngIf="!isLoading; else loader">
    <div mat-dialog-content>
      <div class="collection-list">
        <app-collection-item
          [collection]="item"
          [actions]="isLoggedIn"
          class="collection-list__item"
          (edit)="editCollection(item)"
          (click)="goToCollection(item)"
          [selectable]="post && !!post.id"
          (delete)="deleteCollection(item)"
          *ngFor="let item of collectionList"
          [checked]="isPostInCollection(item)"
          (checkedChange)="onCheckChange($event, item)"
        >
        </app-collection-item>
      </div>
    </div>
  </ng-container>
</ng-container>

<ng-template #createForm>
  <div class="head">
    <strong mat-dialog-title>
      {{
        (currentView === CollectionView.Create ? 'app.add_collection' : 'app.edit_collection')
          | translate
      }}
    </strong>
  </div>

  <div mat-dialog-content class="create-form">
    <form [formGroup]="collectionForm" novalidate>
      <div class="form-row">
        <mat-label>
          {{ 'set.collection_name' | translate }} <span class="color-accent">*</span>
        </mat-label>
        <mat-form-field appearance="outline">
          <input
            matInput
            placeholder="{{ 'set.name_your_collection' | translate }}"
            formControlName="name"
            required
          />
          <mat-error *ngIf="collectionForm.get('name')?.invalid">
            {{ collectionForm.get('name')?.errors | json }}
          </mat-error>
        </mat-form-field>
      </div>
      <div class="form-row">
        <mat-label>{{ 'set.description' | translate }}</mat-label>
        <mat-form-field appearance="outline">
          <textarea
            matInput
            cdkTextareaAutosize
            cdkAutosizeMinRows="3"
            cdkAutosizeMaxRows="6"
            formControlName="description"
          ></textarea>
        </mat-form-field>
      </div>
      <div class="form-row" *ngIf="featuredEnabled">
        <div class="toggle">
          <mat-slide-toggle formControlName="featured" name="first-name">
            {{ 'set.featured' | translate }}
          </mat-slide-toggle>
        </div>
      </div>
      <div class="form-row">
        <mat-label>{{ 'app.who_can_see_this' | translate }}</mat-label>
        <app-group-checkbox-select [data]="roleOptions" formControlName="visible_to">
        </app-group-checkbox-select>
      </div>
      <div class="form-row">
        <mat-label> {{ 'set.default_viewing_mode' | translate }}</mat-label>
        <mat-form-field appearance="outline">
          <mat-select formControlName="view" disableOptionCentering>
            <ng-container *ngFor="let view of views">
              <mat-option [value]="view.name">
                {{ view.display_name | translate }}
              </mat-option>
            </ng-container>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="form-row">
        <div class="toggle">
          <mat-slide-toggle formControlName="is_notifications_enabled" name="first-name">
            {{ 'nav.receive_notifications' | translate }}
          </mat-slide-toggle>
        </div>
      </div>
    </form>
  </div>

  <mat-dialog-actions align="end">
    <button mat-stroked-button (click)="closeModal()">
      {{ 'app.cancel' | translate }}
    </button>
    <button mat-raised-button color="primary" (click)="saveCollection()" id="save-collection-btn">
      {{ 'app.save' | translate }}
    </button>
  </mat-dialog-actions>
</ng-template>

<ng-template #loader>
  <app-spinner class="spinner"></app-spinner>
</ng-template>

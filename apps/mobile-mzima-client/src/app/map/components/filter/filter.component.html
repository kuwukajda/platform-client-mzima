<ion-content class="body">
  <ng-container *ngIf="!isOptionsLoading; else spinner">
    <ng-container [ngSwitch]="type">
      <ng-container *ngSwitchCase="filterType.SELECT">
        <ion-item
          class="button-add"
          *ngIf="filter.name === 'saved-filters' && isLoggedIn"
          button
          lines="none"
          (click)="addClickHandle()"
        >
          <app-icon class="button-add__icon" name="add" slot="start"></app-icon>
          {{ 'app.add_new_filters' | translate }}</ion-item
        >
        <ion-radio-group
          *ngIf="options?.length; else emptyBox"
          [value]="value"
          (ionChange)="radioChangeHandle($event)"
        >
          <app-radio [value]="null">
            {{ 'app.all_filters' | translate }}
            <ion-text class="info" color="medium">{{
              'app.applied_all_filters' | translate
            }}</ion-text>
          </app-radio>
          <app-radio
            *ngFor="let option of options"
            [value]="option.value"
            [editable]="true"
            [deletable]="true"
            (optionDelete)="deleteOption(option)"
            (optionEdit)="editOption(option)"
          >
            {{ option.label }}
            <span class="info">{{ option.info }}</span>
          </app-radio>
        </ion-radio-group>
      </ng-container>
      <ng-container *ngSwitchCase="filterType.MULTISELECT">
        <ng-container *ngIf="options?.length; else emptyBox">
          <app-checkbox
            type="item"
            *ngFor="let option of options"
            [checked]="value.has(option.value)"
            (checkboxChange)="optionChanged($event, option)"
          >
            {{ option.label }}
          </app-checkbox>
        </ng-container>
      </ng-container>
      <ng-container *ngSwitchCase="filterType.MULTILEVELSELECT">
        <ng-container *ngIf="options?.length; else emptyBox">
          <ng-container *ngFor="let option of options">
            <app-checkbox
              type="item"
              [(ngModel)]="option.checked"
              *ngIf="!option.options?.length"
              [option]="option"
              [showCheckboxAvatar]="!option.options?.length"
              [firstLetter]="getFirstLetter(option.label)"
              (checkboxChange)="optionChanged($event, option)"
            >
              {{ option.label }}
            </app-checkbox>
            <ion-item
              button
              class="multiselect-option"
              lines="none"
              *ngIf="option.options?.length"
              (click)="toggleSubcategoryDropdown(option)"
            >
              <ion-avatar
                slot="start"
                class="multiselect-option__visual"
                [ngStyle]="{ '--item-color': option.color }"
              >
                {{ getFirstLetter(option.label) }}
              </ion-avatar>
              <div>
                {{ option.label }}
                <span class="multiselect-option__info">
                  {{
                    'app.categories.filter_info.subcategories.selected'
                      | translate
                        : {
                            checkedOption: getCheckedSubcategoriesLength(option.options),
                            optionsTotal: option.options?.length
                          }
                  }}
                </span>
              </div>
              <app-icon
                class="multiselect-option__details"
                [ngClass]="{ 'multiselect-option__icon-facedown': option.isDropDownOpen }"
                slot="end"
                name="arrow-right"
              >
              </app-icon>
            </ion-item>
            <ng-container *ngIf="option.isDropDownOpen">
              <ng-container *ngFor="let childOption of option.options">
                <app-checkbox
                  type="item"
                  [(ngModel)]="childOption.checked"
                  (ngModelChange)="isSubcategoriesPristine = false"
                  (checkboxChange)="optionChanged($event, childOption)"
                >
                  {{ childOption.label }}
                </app-checkbox>
              </ng-container>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
      <ng-container *ngSwitchCase="filterType.DATE">
        <app-date-select [(ngModel)]="value" (ngModelChange)="isPristine = false"></app-date-select>
      </ng-container>
      <ng-container *ngSwitchCase="filterType.LOCATION">
        <app-location-select
          [(ngModel)]="value"
          (ngModelChange)="isPristine = false"
        ></app-location-select>
      </ng-container>
    </ng-container>
  </ng-container>
</ion-content>

<ion-footer class="footer">
  <ion-toolbar class="footer__toolbar">
    <div class="btn-panel">
      <app-button
        expand="inline"
        [disabled]="isPristine || isSubcategoriesPristine"
        (buttonClick)="applyFilter()"
      >
        {{ 'app.apply' | translate }}
      </app-button>
      <app-button
        clear-btn
        fill="outline"
        color="medium"
        expand="inline"
        class="filters-modal__button"
        (buttonClick)="clearFilter()"
        *ngIf="filter.name !== 'saved-filters'"
      >
        {{ 'app.clear' | translate }}
      </app-button>
    </div>
  </ion-toolbar>
</ion-footer>

<ng-template #spinner>
  <div class="spinner-container">
    <app-spinner *ngIf="isOptionsLoading"></app-spinner>
  </div>
</ng-template>

<ng-template #emptyBox>
  <ion-text
    color="medium"
    class="empty ion-padding"
    [ngClass]="{ 'empty--with-button': filter.name === 'saved-filters' }"
  >
    {{ filter.noOptionsText }}
  </ion-text>
</ng-template>
